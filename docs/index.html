<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapterhorn Martin</title>
<script src="https://unpkg.com/maplibre-gl@5.6.1/dist/maplibre-gl.js"></script>
<link href="https://unpkg.com/maplibre-gl@5.6.1/dist/maplibre-gl.css" rel="stylesheet" />
<style>
body { 
  margin: 0; 
  background: #1a1a1a; 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
  color: #fff;
} 
#map { 
  width: 100vw; 
  height: 100vh; 
}
#terrain-controls {
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(0, 0, 0, 0.9);
  border-radius: 10px;
  padding: 20px;
  z-index: 1000;
  font-size: 14px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  min-width: 250px;
}
#terrain-controls h4 {
  margin: 0 0 15px 0;
  color: #87CEEB;
  font-size: 1.2em;
}
#terrain-controls label {
  display: block;
  margin-bottom: 10px;
  color: #ccc;
}
#terrain-controls input[type="range"] {
  width: 150px;
  margin-left: 10px;
}
#terrain-controls input[type="checkbox"] {
  margin-right: 8px;
}
#terrain-controls select {
  margin-left: 10px;
  padding: 4px;
  background: #333;
  color: #fff;
  border: 1px solid #555;
  border-radius: 3px;
  font-size: 12px;
}
#terrain-controls button {
  margin: 5px 5px 0 0;
  padding: 8px 12px;
  background: #007cbf;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 12px;
}
#terrain-controls button:hover {
  background: #005a8c;
}
#info-panel {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(0, 0, 0, 0.9);
  border-radius: 10px;
  padding: 15px;
  max-width: 300px;
  font-size: 12px;
  color: #ccc;
  border: 1px solid rgba(255, 255, 255, 0.2);
}
</style>
</head>
<body>
<div id="map"></div>

<div id="terrain-controls">
  <h4>üèîÔ∏è Terrain Visualization</h4>
  
  <label>
    Terrain Source:
    <select id="terrain-source" style="margin-left: 10px; padding: 4px; background: #333; color: #fff; border: 1px solid #555; border-radius: 3px;">
      <option value="mapterhorn">Mapterhorn (Terrarium)</option>
      <option value="gel">Gel (Mapbox)</option>
    </select>
  </label>
  
  <label>
    <input type="checkbox" id="hillshade" checked> Hillshade Effects
  </label>
  
  <label>
    <input type="checkbox" id="terrain-3d" checked> 3D Terrain
  </label>
  
  <div style="margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px;">
    <button id="reset-view">Reset View</button>
    <button id="fly-to-matterhorn">Matterhorn</button>
    <button id="zermatt-view">Zermatt</button>
    <button id="glacier-view">Glacier</button>
  </div>
</div>

<div id="info-panel">
  <strong>Data Source:</strong> <span id="current-source">Mapterhorn Project</span><br>
  <strong>Encoding:</strong> <span id="current-encoding">Terrarium</span><br>
  <strong>Tile Size:</strong> 512px<br>
  <strong>Technology:</strong> MapLibre GL JS + WebGL<br>
  <br>
  <em>Real-time 3D terrain visualization with interactive controls</em>
</div>

<script>
// Mapterhorn terrain style configuration
const style = {
    "version": 8,
    "sources": {
        "protomaps": {
            "type": "vector",
            "attribution": "<a href=\"https://github.com/protomaps/basemaps\">Protomaps</a> ¬© <a href=\"https://openstreetmap.org\">OpenStreetMap</a>",
            "url": "https://tunnel.optgeo.org/martin/protomaps-basemap"
        },
        "mapterhorn-terrain": {
            "type": "raster-dem",
            "url": "https://tunnel.optgeo.org/martin/mapterhorn",
            "tileSize": 512,
            "encoding": "terrarium"
        },
        "mapterhorn-hillshade": {
            "type": "raster-dem",
            "url": "https://tunnel.optgeo.org/martin/mapterhorn",
            "tileSize": 512,
            "encoding": "terrarium"
        },
        "gel-terrain": {
            "type": "raster-dem",
            "url": "https://tunnel.optgeo.org/martin/gel",
            "tileSize": 512,
            "encoding": "mapbox"
        },
        "gel-hillshade": {
            "type": "raster-dem",
            "url": "https://tunnel.optgeo.org/martin/gel",
            "tileSize": 512,
            "encoding": "mapbox"
        }
    },
    "terrain": {
        "source": "mapterhorn-terrain",
        "exaggeration": 1.0
    },
    "layers": [
        {
            "id": "background",
            "type": "background",
            "paint": {
                "background-color": "#f0f8ff"
            }
        },
        {
            "id": "hillshade",
            "type": "hillshade",
            "source": "mapterhorn-hillshade",
            "paint": {
                "hillshade-shadow-color": "#473B24",
                "hillshade-highlight-color": "#ffffff",
                "hillshade-accent-color": "#5d4a1f",
                "hillshade-illumination-direction": 315,
                "hillshade-illumination-anchor": "map",
                "hillshade-exaggeration": 0.8
            }
        },
        {
            "id": "earth",
            "type": "fill",
            "filter": ["==", "$type", "Polygon"],
            "source": "protomaps",
            "source-layer": "earth",
            "paint": {
                "fill-color": "#e8e5e0",
                "fill-opacity": 0.8
            }
        },
        {
            "id": "landcover",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landcover",
            "paint": {
                "fill-color": [
                    "match",
                    ["get", "kind"],
                    "glacier", "#ffffff",
                    "grassland", "#c8d8c8",
                    "forest", "#6b8e3b",
                    "scrub", "#99d2bb",
                    "barren", "#d4c4a0",
                    "#e8e5e0"
                ],
                "fill-opacity": [
                    "interpolate",
                    ["linear"],
                    ["zoom"],
                    8, 0.6,
                    12, 0.8
                ]
            }
        },
        {
            "id": "water",
            "type": "fill",
            "filter": ["==", "$type", "Polygon"],
            "source": "protomaps",
            "source-layer": "water",
            "paint": {
                "fill-color": "#4a9eff",
                "fill-opacity": 0.8
            }
        },
        {
            "id": "roads_highway",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": ["==", "kind", "highway"],
            "paint": {
                "line-color": "#ffffff",
                "line-width": [
                    "interpolate",
                    ["exponential", 1.6],
                    ["zoom"],
                    6, 0.5,
                    12, 2,
                    18, 8
                ]
            }
        },
        {
            "id": "roads_major",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": ["==", "kind", "major_road"],
            "paint": {
                "line-color": "#ffffff",
                "line-width": [
                    "interpolate",
                    ["exponential", 1.6],
                    ["zoom"],
                    8, 0.3,
                    12, 1.5,
                    18, 6
                ]
            }
        },
        {
            "id": "places_locality",
            "type": "symbol",
            "source": "protomaps",
            "source-layer": "places",
            "filter": ["==", "kind", "locality"],
            "layout": {
                "text-field": ["get", "name"],
                "text-font": ["Noto Sans Regular"],
                "text-size": [
                    "interpolate",
                    ["linear"],
                    ["zoom"],
                    8, 10,
                    12, 14
                ]
            },
            "paint": {
                "text-color": "#2d2d2d",
                "text-halo-color": "#ffffff",
                "text-halo-width": 2
            }
        }
    ],
    "sprite": "https://protomaps.github.io/basemaps-assets/sprites/v4/light",
    "glyphs": "https://protomaps.github.io/basemaps-assets/fonts/{fontstack}/{range}.pbf"
};

// Initialize map
const map = new maplibregl.Map({
    container: 'map',
    style: style,
    center: [7.7461, 46.0382], // Matterhorn coordinates
    zoom: 12,
    pitch: 60,
    bearing: 0,
    antialias: true,
    hash: true
});

// Add controls
map.addControl(new maplibregl.NavigationControl({
    visualizePitch: true,
    showZoom: true,
    showCompass: true
}));

map.addControl(new maplibregl.GlobeControl());

// Enable terrain when map loads
map.on('load', () => {
    const source = terrainSources[currentTerrainSource];
    map.setTerrain({
        source: source.terrain,
        exaggeration: 1.0
    });
});

// Terrain control functionality
const hillshadeCheckbox = document.getElementById('hillshade');
const terrain3dCheckbox = document.getElementById('terrain-3d');
const terrainSourceSelect = document.getElementById('terrain-source');
const currentSourceSpan = document.getElementById('current-source');
const currentEncodingSpan = document.getElementById('current-encoding');
const resetViewButton = document.getElementById('reset-view');
const flyToMatterhornButton = document.getElementById('fly-to-matterhorn');
const zermattViewButton = document.getElementById('zermatt-view');
const glacierViewButton = document.getElementById('glacier-view');

// Current active terrain source
let currentTerrainSource = 'mapterhorn';

// Terrain source configuration
const terrainSources = {
    mapterhorn: {
        terrain: 'mapterhorn-terrain',
        hillshade: 'mapterhorn-hillshade',
        displayName: 'Mapterhorn Project',
        encoding: 'Terrarium'
    },
    gel: {
        terrain: 'gel-terrain',
        hillshade: 'gel-hillshade',
        displayName: 'Gel Project',
        encoding: 'Mapbox'
    }
};

// Function to update terrain source
function updateTerrainSource(sourceKey) {
    const source = terrainSources[sourceKey];
    if (!source) return;
    
    currentTerrainSource = sourceKey;
    
    // Update terrain if 3D is enabled
    if (terrain3dCheckbox.checked) {
        map.setTerrain({ source: source.terrain, exaggeration: 1.0 });
    }
    
    // Update hillshade source
    map.getStyle().layers.forEach(layer => {
        if (layer.id === 'hillshade') {
            map.removeLayer('hillshade');
        }
    });
    
    // Re-add hillshade layer with new source
    map.addLayer({
        "id": "hillshade",
        "type": "hillshade",
        "source": source.hillshade,
        "paint": {
            "hillshade-shadow-color": "#473B24",
            "hillshade-highlight-color": "#ffffff",
            "hillshade-accent-color": "#5d4a1f",
            "hillshade-illumination-direction": 315,
            "hillshade-illumination-anchor": "map",
            "hillshade-exaggeration": 0.8
        }
    }, 'earth'); // Insert before earth layer
    
    // Update visibility based on checkbox state
    const visibility = hillshadeCheckbox.checked ? 'visible' : 'none';
    map.setLayoutProperty('hillshade', 'visibility', visibility);
    
    // Update info panel
    currentSourceSpan.textContent = source.displayName;
    currentEncodingSpan.textContent = source.encoding;
    
    console.log(`Switched to ${source.displayName} (${source.encoding} encoding)`);
}

// Terrain source selector
terrainSourceSelect.addEventListener('change', (e) => {
    updateTerrainSource(e.target.value);
});

// Hillshade toggle
hillshadeCheckbox.addEventListener('change', (e) => {
    const visibility = e.target.checked ? 'visible' : 'none';
    map.setLayoutProperty('hillshade', 'visibility', visibility);
});

// 3D terrain toggle
terrain3dCheckbox.addEventListener('change', (e) => {
    if (e.target.checked) {
        const source = terrainSources[currentTerrainSource];
        map.setTerrain({ source: source.terrain, exaggeration: 1.0 });
    } else {
        map.setTerrain(null);
    }
});

// Predefined viewpoints
const viewpoints = {
    default: {
        center: [7.7461, 46.0382],
        zoom: 12,
        pitch: 60,
        bearing: 0
    },
    matterhorn: {
        center: [7.7462, 45.9763],
        zoom: 15,
        pitch: 75,
        bearing: 25
    },
    zermatt: {
        center: [7.7461, 46.0278],
        zoom: 13,
        pitch: 50,
        bearing: 180
    },
    glacier: {
        center: [7.7580, 45.9850],
        zoom: 14,
        pitch: 60,
        bearing: 90
    }
};

// Navigation functions
function flyToViewpoint(viewpoint) {
    map.flyTo({
        center: viewpoint.center,
        zoom: viewpoint.zoom,
        pitch: viewpoint.pitch,
        bearing: viewpoint.bearing,
        duration: 3000
    });
}

// Button event listeners
resetViewButton.addEventListener('click', () => {
    flyToViewpoint(viewpoints.default);
});

flyToMatterhornButton.addEventListener('click', () => {
    flyToViewpoint(viewpoints.matterhorn);
});

zermattViewButton.addEventListener('click', () => {
    flyToViewpoint(viewpoints.zermatt);
});

glacierViewButton.addEventListener('click', () => {
    flyToViewpoint(viewpoints.glacier);
});

// Log terrain configuration
console.log('Terrain Visualization initialized');
console.log('Available sources: Mapterhorn (Terrarium), Gel (Mapbox)');
console.log('Features: 3D terrain, hillshade, interactive controls, source switching');

</script>
</body>
</html>