<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapterhorn Terrain Visualization</title>
<script src="https://unpkg.com/maplibre-gl@5.6.1/dist/maplibre-gl.js"></script>
<link href="https://unpkg.com/maplibre-gl@5.6.1/dist/maplibre-gl.css" rel="stylesheet" />
<style>
body { 
  margin: 0; 
  background: #1a1a1a; 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
  color: #fff;
} 
#map { 
  width: 100vw; 
  height: 100vh; 
}
#terrain-controls {
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(0, 0, 0, 0.9);
  border-radius: 10px;
  padding: 20px;
  z-index: 1000;
  font-size: 14px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  min-width: 250px;
}
#terrain-controls h4 {
  margin: 0 0 15px 0;
  color: #87CEEB;
  font-size: 1.2em;
}
#terrain-controls label {
  display: block;
  margin-bottom: 10px;
  color: #ccc;
}
#terrain-controls input[type="range"] {
  width: 150px;
  margin-left: 10px;
}
#terrain-controls input[type="checkbox"] {
  margin-right: 8px;
}
#terrain-controls button {
  margin: 5px 5px 0 0;
  padding: 8px 12px;
  background: #007cbf;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 12px;
}
#terrain-controls button:hover {
  background: #005a8c;
}
#properties-panel {
  position: fixed;
  top: 0;
  right: 0;
  width: 350px;
  height: 100vh;
  background: rgba(255, 255, 255, 0.9);
  border-left: 1px solid #ccc;
  overflow-y: auto;
  padding: 15px;
  box-sizing: border-box;
  display: none;
  z-index: 1000;
}
#properties-panel h3 {
  margin: 0 0 10px 0;
  color: #333;
  font-size: 16px;
}
.feature-item {
  margin-bottom: 15px;
  border: 1px solid #ddd;
  border-radius: 4px;
  background: white;
}
.feature-header {
  padding: 8px 12px;
  background: #f5f5f5;
  border-bottom: 1px solid #ddd;
  cursor: pointer;
  font-weight: bold;
  font-size: 14px;
}
.feature-header:hover {
  background: #eee;
}
.feature-properties {
  padding: 10px 12px;
  font-family: monospace;
  font-size: 12px;
  white-space: pre-wrap;
  word-break: break-word;
  max-height: 200px;
  overflow-y: auto;
}
.feature-properties.collapsed {
  display: none;
}
#close-panel {
  position: absolute;
  top: 10px;
  right: 15px;
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  color: #666;
}
#close-panel:hover {
  color: #000;
}
#info-panel {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(0, 0, 0, 0.9);
  border-radius: 10px;
  padding: 15px;
  max-width: 300px;
  font-size: 12px;
  color: #ccc;
  border: 1px solid rgba(255, 255, 255, 0.2);
}
</style>
</head>
<body>
<div id="map"></div>

<div id="terrain-controls">
  <h4>üèîÔ∏è Mapterhorn Terrain</h4>
  
  <label>
    <input type="checkbox" id="hillshade" checked> Hillshade Effects
  </label>
  
  <label>
    <input type="checkbox" id="terrain-3d" checked> 3D Terrain
  </label>
  
  <div style="margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px;">
    <button id="reset-view">Reset View</button>
    <button id="fly-to-matterhorn">Matterhorn</button>
    <button id="zermatt-view">Zermatt</button>
    <button id="glacier-view">Glacier</button>
  </div>
</div>

<div id="info-panel">
  <strong>Data Source:</strong> Mapterhorn Project<br>
  <strong>Encoding:</strong> Terrarium<br>
  <strong>Tile Size:</strong> 512px<br>
  <strong>Technology:</strong> MapLibre GL JS + WebGL<br>
  <br>
  <em>Real-time 3D terrain visualization with interactive controls</em>
</div>

<div id="properties-panel">
  <button id="close-panel">&times;</button>
  <h3>Feature Properties</h3>
  <div id="properties-content"></div>
</div>

<script>
// Mapterhorn terrain style configuration
const style = {
    "version": 8,
    "sources": {
        "protomaps": {
            "type": "vector",
            "attribution": "<a href=\"https://github.com/protomaps/basemaps\">Protomaps</a> ¬© <a href=\"https://openstreetmap.org\">OpenStreetMap</a>",
            "url": "https://tunnel.optgeo.org/martin/protomaps-basemap"
        },
        "mapterhorn-terrain": {
            "type": "raster-dem",
            "url": "https://tunnel.optgeo.org/martin/mapterhorn",
            "tileSize": 512,
            "encoding": "terrarium"
        },
        "mapterhorn-hillshade": {
            "type": "raster-dem",
            "url": "https://tunnel.optgeo.org/martin/mapterhorn",
            "tileSize": 512,
            "encoding": "terrarium"
        }
    },
    "terrain": {
        "source": "mapterhorn-terrain",
        "exaggeration": 1.0
    },
    "layers": [
        {
            "id": "background",
            "type": "background",
            "paint": {
                "background-color": "#cccccc"
            }
        },
        {
            "id": "hillshade",
            "type": "hillshade",
            "source": "mapterhorn-hillshade",
            "paint": {
                "hillshade-shadow-color": "#473B24",
                "hillshade-highlight-color": "#ffffff",
                "hillshade-accent-color": "#5d4a1f",
                "hillshade-illumination-direction": 315,
                "hillshade-illumination-anchor": "map",
                "hillshade-exaggeration": 0.8
            }
        },
        {
            "id": "earth",
            "type": "fill",
            "filter": [
                "==",
                "$type",
                "Polygon"
            ],
            "source": "protomaps",
            "source-layer": "earth",
            "paint": {
                "fill-color": "#e2dfda"
            }
        },
        {
            "id": "landcover",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landcover",
            "paint": {
                "fill-color": [
                    "match",
                    [
                        "get",
                        "kind"
                    ],
                    "grassland",
                    "rgba(210, 239, 207, 1)",
                    "barren",
                    "rgba(255, 243, 215, 1)",
                    "urban_area",
                    "rgba(230, 230, 230, 1)",
                    "farmland",
                    "rgba(216, 239, 210, 1)",
                    "glacier",
                    "rgba(255, 255, 255, 1)",
                    "scrub",
                    "rgba(234, 239, 210, 1)",
                    "rgba(196, 231, 210, 1)"
                ],
                "fill-opacity": [
                    "interpolate",
                    [
                        "linear"
                    ],
                    [
                        "zoom"
                    ],
                    5,
                    1,
                    7,
                    0
                ]
            }
        },
        {
            "id": "landuse_park",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "in",
                "kind",
                "national_park",
                "park",
                "cemetery",
                "protected_area",
                "nature_reserve",
                "forest",
                "golf_course",
                "wood",
                "nature_reserve",
                "forest",
                "scrub",
                "grassland",
                "grass",
                "military",
                "naval_base",
                "airfield"
            ],
            "paint": {
                "fill-opacity": [
                    "interpolate",
                    [
                        "linear"
                    ],
                    [
                        "zoom"
                    ],
                    6,
                    0,
                    11,
                    1
                ],
                "fill-color": [
                    "case",
                    [
                        "in",
                        [
                            "get",
                            "kind"
                        ],
                        [
                            "literal",
                            [
                                "national_park",
                                "park",
                                "cemetery",
                                "protected_area",
                                "nature_reserve",
                                "forest",
                                "golf_course"
                            ]
                        ]
                    ],
                    "#9cd3b4",
                    [
                        "in",
                        [
                            "get",
                            "kind"
                        ],
                        [
                            "literal",
                            [
                                "wood",
                                "nature_reserve",
                                "forest"
                            ]
                        ]
                    ],
                    "#a0d9a0",
                    [
                        "in",
                        [
                            "get",
                            "kind"
                        ],
                        [
                            "literal",
                            [
                                "scrub",
                                "grassland",
                                "grass"
                            ]
                        ]
                    ],
                    "#99d2bb",
                    [
                        "in",
                        [
                            "get",
                            "kind"
                        ],
                        [
                            "literal",
                            [
                                "glacier"
                            ]
                        ]
                    ],
                    "#e7e7e7",
                    [
                        "in",
                        [
                            "get",
                            "kind"
                        ],
                        [
                            "literal",
                            [
                                "sand"
                            ]
                        ]
                    ],
                    "#e2e0d7",
                    [
                        "in",
                        [
                            "get",
                            "kind"
                        ],
                        [
                            "literal",
                            [
                                "military",
                                "naval_base",
                                "airfield"
                            ]
                        ]
                    ],
                    "#c6dcdc",
                    "#e2dfda"
                ]
            }
        },
        {
            "id": "landuse_urban_green",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "in",
                "kind",
                "allotments",
                "village_green",
                "playground"
            ],
            "paint": {
                "fill-color": "#9cd3b4",
                "fill-opacity": 0.7
            }
        },
        {
            "id": "landuse_hospital",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "==",
                "kind",
                "hospital"
            ],
            "paint": {
                "fill-color": "#e4dad9"
            }
        },
        {
            "id": "landuse_industrial",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "==",
                "kind",
                "industrial"
            ],
            "paint": {
                "fill-color": "#d1dde1"
            }
        },
        {
            "id": "landuse_school",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "in",
                "kind",
                "school",
                "university",
                "college"
            ],
            "paint": {
                "fill-color": "#e4ded7"
            }
        },
        {
            "id": "landuse_beach",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "in",
                "kind",
                "beach"
            ],
            "paint": {
                "fill-color": "#e8e4d0"
            }
        },
        {
            "id": "landuse_zoo",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "in",
                "kind",
                "zoo"
            ],
            "paint": {
                "fill-color": "#c6dcdc"
            }
        },
        {
            "id": "landuse_aerodrome",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "in",
                "kind",
                "aerodrome"
            ],
            "paint": {
                "fill-color": "#dadbdf"
            }
        },
        {
            "id": "roads_runway",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "==",
                "kind_detail",
                "runway"
            ],
            "paint": {
                "line-color": "#e9e9ed",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    10,
                    0,
                    12,
                    4,
                    18,
                    30
                ]
            }
        },
        {
            "id": "roads_taxiway",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 13,
            "filter": [
                "==",
                "kind_detail",
                "taxiway"
            ],
            "paint": {
                "line-color": "#e9e9ed",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    13.5,
                    1,
                    15,
                    6
                ]
            }
        },
        {
            "id": "landuse_runway",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "any",
                [
                    "in",
                    "kind",
                    "runway",
                    "taxiway"
                ]
            ],
            "paint": {
                "fill-color": "#e9e9ed"
            }
        },
        {
            "id": "water",
            "type": "fill",
            "filter": [
                "==",
                "$type",
                "Polygon"
            ],
            "source": "protomaps",
            "source-layer": "water",
            "paint": {
                "fill-color": "#80deea"
            }
        },
        {
            "id": "water_stream",
            "type": "line",
            "source": "protomaps",
            "source-layer": "water",
            "minzoom": 14,
            "filter": [
                "in",
                "kind",
                "stream"
            ],
            "paint": {
                "line-color": "#80deea",
                "line-width": 0.5
            }
        },
        {
            "id": "water_river",
            "type": "line",
            "source": "protomaps",
            "source-layer": "water",
            "minzoom": 9,
            "filter": [
                "in",
                "kind",
                "river"
            ],
            "paint": {
                "line-color": "#80deea",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    9,
                    0,
                    9.5,
                    1,
                    18,
                    12
                ]
            }
        },
        {
            "id": "landuse_pedestrian",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "in",
                "kind",
                "pedestrian",
                "dam"
            ],
            "paint": {
                "fill-color": "#e3e0d4"
            }
        },
        {
            "id": "landuse_pier",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "landuse",
            "filter": [
                "==",
                "kind",
                "pier"
            ],
            "paint": {
                "fill-color": "#e0e0e0"
            }
        },
        {
            "id": "roads_tunnels_other_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "has",
                    "is_tunnel"
                ],
                [
                    "in",
                    "kind",
                    "other",
                    "path"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    14,
                    0,
                    20,
                    7
                ]
            }
        },
        {
            "id": "roads_tunnels_minor_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "has",
                    "is_tunnel"
                ],
                [
                    "==",
                    "kind",
                    "minor_road"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-dasharray": [
                    3,
                    2
                ],
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    11,
                    0,
                    12.5,
                    0.5,
                    15,
                    2,
                    18,
                    11
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    12,
                    0,
                    12.5,
                    1
                ]
            }
        },
        {
            "id": "roads_tunnels_link_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "has",
                    "is_tunnel"
                ],
                [
                    "has",
                    "is_link"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-dasharray": [
                    3,
                    2
                ],
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    13.5,
                    1,
                    18,
                    11
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    12,
                    0,
                    12.5,
                    1
                ]
            }
        },
        {
            "id": "roads_tunnels_major_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "major_road"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-dasharray": [
                    3,
                    2
                ],
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    7,
                    0,
                    7.5,
                    0.5,
                    18,
                    13
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    9,
                    0,
                    9.5,
                    1
                ]
            }
        },
        {
            "id": "roads_tunnels_highway_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "highway"
                ],
                [
                    "!has",
                    "is_link"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-dasharray": [
                    6,
                    0.5
                ],
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    3,
                    0,
                    3.5,
                    0.5,
                    18,
                    15
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    7,
                    0,
                    7.5,
                    1,
                    20,
                    15
                ]
            }
        },
        {
            "id": "roads_tunnels_other",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "has",
                    "is_tunnel"
                ],
                [
                    "in",
                    "kind",
                    "other",
                    "path"
                ]
            ],
            "paint": {
                "line-color": "#d5d5d5",
                "line-dasharray": [
                    4.5,
                    0.5
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    14,
                    0,
                    20,
                    7
                ]
            }
        },
        {
            "id": "roads_tunnels_minor",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "has",
                    "is_tunnel"
                ],
                [
                    "==",
                    "kind",
                    "minor_road"
                ]
            ],
            "paint": {
                "line-color": "#d5d5d5",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    11,
                    0,
                    12.5,
                    0.5,
                    15,
                    2,
                    18,
                    11
                ]
            }
        },
        {
            "id": "roads_tunnels_link",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "has",
                    "is_tunnel"
                ],
                [
                    "has",
                    "is_link"
                ]
            ],
            "paint": {
                "line-color": "#d5d5d5",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    13.5,
                    1,
                    18,
                    11
                ]
            }
        },
        {
            "id": "roads_tunnels_major",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "has",
                    "is_tunnel"
                ],
                [
                    "==",
                    "kind",
                    "major_road"
                ]
            ],
            "paint": {
                "line-color": "#d5d5d5",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    6,
                    0,
                    12,
                    1.6,
                    15,
                    3,
                    18,
                    13
                ]
            }
        },
        {
            "id": "roads_tunnels_highway",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "has",
                    "is_tunnel"
                ],
                [
                    "==",
                    [
                        "get",
                        "kind"
                    ],
                    "highway"
                ],
                [
                    "!",
                    [
                        "has",
                        "is_link"
                    ]
                ]
            ],
            "paint": {
                "line-color": "#d5d5d5",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    3,
                    0,
                    6,
                    1.1,
                    12,
                    1.6,
                    15,
                    5,
                    18,
                    15
                ]
            }
        },
        {
            "id": "buildings",
            "type": "fill",
            "source": "protomaps",
            "source-layer": "buildings",
            "filter": [
                "in",
                "kind",
                "building",
                "building_part"
            ],
            "paint": {
                "fill-color": "#cccccc",
                "fill-opacity": 0.5
            }
        },
        {
            "id": "roads_pier",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "==",
                "kind_detail",
                "pier"
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    12,
                    0,
                    12.5,
                    0.5,
                    20,
                    16
                ]
            }
        },
        {
            "id": "roads_minor_service_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 13,
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "minor_road"
                ],
                [
                    "==",
                    "kind_detail",
                    "service"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    18,
                    8
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    13.5,
                    0.8
                ]
            }
        },
        {
            "id": "roads_minor_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "minor_road"
                ],
                [
                    "!=",
                    "kind_detail",
                    "service"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    11,
                    0,
                    12.5,
                    0.5,
                    15,
                    2,
                    18,
                    11
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    12,
                    0,
                    12.5,
                    1
                ]
            }
        },
        {
            "id": "roads_link_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 13,
            "filter": [
                "has",
                "is_link"
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    13.5,
                    1,
                    18,
                    11
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    13.5,
                    1.5
                ]
            }
        },
        {
            "id": "roads_major_casing_late",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "major_road"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    6,
                    0,
                    12,
                    1.6,
                    15,
                    3,
                    18,
                    13
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    9,
                    0,
                    9.5,
                    1
                ]
            }
        },
        {
            "id": "roads_highway_casing_late",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "highway"
                ],
                [
                    "!has",
                    "is_link"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    3,
                    0,
                    3.5,
                    0.5,
                    18,
                    15
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    7,
                    0,
                    7.5,
                    1,
                    20,
                    15
                ]
            }
        },
        {
            "id": "roads_other",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "in",
                    "kind",
                    "other",
                    "path"
                ],
                [
                    "!=",
                    "kind_detail",
                    "pier"
                ]
            ],
            "paint": {
                "line-color": "#ebebeb",
                "line-dasharray": [
                    3,
                    1
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    14,
                    0,
                    20,
                    7
                ]
            }
        },
        {
            "id": "roads_link",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "has",
                "is_link"
            ],
            "paint": {
                "line-color": "#ffffff",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    13.5,
                    1,
                    18,
                    11
                ]
            }
        },
        {
            "id": "roads_minor_service",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "minor_road"
                ],
                [
                    "==",
                    "kind_detail",
                    "service"
                ]
            ],
            "paint": {
                "line-color": "#ebebeb",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    18,
                    8
                ]
            }
        },
        {
            "id": "roads_minor",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "minor_road"
                ],
                [
                    "!=",
                    "kind_detail",
                    "service"
                ]
            ],
            "paint": {
                "line-color": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    11,
                    "#ebebeb",
                    16,
                    "#ffffff"
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    11,
                    0,
                    12.5,
                    0.5,
                    15,
                    2,
                    18,
                    11
                ]
            }
        },
        {
            "id": "roads_major_casing_early",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "maxzoom": 12,
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "major_road"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    7,
                    0,
                    7.5,
                    0.5,
                    18,
                    13
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    9,
                    0,
                    9.5,
                    1
                ]
            }
        },
        {
            "id": "roads_major",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "major_road"
                ]
            ],
            "paint": {
                "line-color": "#ffffff",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    6,
                    0,
                    12,
                    1.6,
                    15,
                    3,
                    18,
                    13
                ]
            }
        },
        {
            "id": "roads_highway_casing_early",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "maxzoom": 12,
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "highway"
                ],
                [
                    "!has",
                    "is_link"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    3,
                    0,
                    3.5,
                    0.5,
                    18,
                    15
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    7,
                    0,
                    7.5,
                    1
                ]
            }
        },
        {
            "id": "roads_highway",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "!has",
                    "is_tunnel"
                ],
                [
                    "!has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "highway"
                ],
                [
                    "!has",
                    "is_link"
                ]
            ],
            "paint": {
                "line-color": "#ffffff",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    3,
                    0,
                    6,
                    1.1,
                    12,
                    1.6,
                    15,
                    5,
                    18,
                    15
                ]
            }
        },
        {
            "id": "roads_rail",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "==",
                "kind",
                "rail"
            ],
            "paint": {
                "line-dasharray": [
                    0.3,
                    0.75
                ],
                "line-opacity": 0.5,
                "line-color": "#a7b1b3",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    3,
                    0,
                    6,
                    0.15,
                    18,
                    9
                ]
            }
        },
        {
            "id": "boundaries_country",
            "type": "line",
            "source": "protomaps",
            "source-layer": "boundaries",
            "filter": [
                "<=",
                "kind_detail",
                2
            ],
            "paint": {
                "line-color": "#adadad",
                "line-width": [
                    "case",
                    ["get", "disputed"],
                    0,
                    0.7
                ],
                "line-dasharray": [
                    "step",
                    [
                        "zoom"
                    ],
                    [
                        "literal",
                        [
                            2,
                            0
                        ]
                    ],
                    4,
                    [
                        "literal",
                        [
                            2,
                            1
                        ]
                    ]
                ]
            }
        },
        {
            "id": "boundaries",
            "type": "line",
            "source": "protomaps",
            "source-layer": "boundaries",
            "filter": [
                ">",
                "kind_detail",
                2
            ],
            "paint": {
                "line-color": "#adadad",
                "line-width": 0.4,
                "line-dasharray": [
                    "step",
                    [
                        "zoom"
                    ],
                    [
                        "literal",
                        [
                            2,
                            0
                        ]
                    ],
                    4,
                    [
                        "literal",
                        [
                            2,
                            1
                        ]
                    ]
                ]
            }
        },
        {
            "id": "roads_bridges_other_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "has",
                    "is_bridge"
                ],
                [
                    "in",
                    "kind",
                    "other",
                    "path"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    14,
                    0,
                    20,
                    7
                ]
            }
        },
        {
            "id": "roads_bridges_link_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "has",
                    "is_bridge"
                ],
                [
                    "has",
                    "is_link"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    13.5,
                    1,
                    18,
                    11
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    12,
                    0,
                    12.5,
                    1.5
                ]
            }
        },
        {
            "id": "roads_bridges_minor_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "minor_road"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    11,
                    0,
                    12.5,
                    0.5,
                    15,
                    2,
                    18,
                    11
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    13.5,
                    0.8
                ]
            }
        },
        {
            "id": "roads_bridges_major_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "major_road"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    7,
                    0,
                    7.5,
                    0.5,
                    18,
                    10
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    9,
                    0,
                    9.5,
                    1.5
                ]
            }
        },
        {
            "id": "roads_bridges_other",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "has",
                    "is_bridge"
                ],
                [
                    "in",
                    "kind",
                    "other",
                    "path"
                ]
            ],
            "paint": {
                "line-color": "#ebebeb",
                "line-dasharray": [
                    2,
                    1
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    14,
                    0,
                    20,
                    7
                ]
            }
        },
        {
            "id": "roads_bridges_minor",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "minor_road"
                ]
            ],
            "paint": {
                "line-color": "#ffffff",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    11,
                    0,
                    12.5,
                    0.5,
                    15,
                    2,
                    18,
                    11
                ]
            }
        },
        {
            "id": "roads_bridges_link",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "has",
                    "is_bridge"
                ],
                [
                    "has",
                    "is_link"
                ]
            ],
            "paint": {
                "line-color": "#ffffff",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    13,
                    0,
                    13.5,
                    1,
                    18,
                    11
                ]
            }
        },
        {
            "id": "roads_bridges_major",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "major_road"
                ]
            ],
            "paint": {
                "line-color": "#f5f5f5",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    6,
                    0,
                    12,
                    1.6,
                    15,
                    3,
                    18,
                    13
                ]
            }
        },
        {
            "id": "roads_bridges_highway_casing",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "minzoom": 12,
            "filter": [
                "all",
                [
                    "has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "highway"
                ],
                [
                    "!has",
                    "is_link"
                ]
            ],
            "paint": {
                "line-color": "#e0e0e0",
                "line-gap-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    3,
                    0,
                    3.5,
                    0.5,
                    18,
                    15
                ],
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    7,
                    0,
                    7.5,
                    1,
                    20,
                    15
                ]
            }
        },
        {
            "id": "roads_bridges_highway",
            "type": "line",
            "source": "protomaps",
            "source-layer": "roads",
            "filter": [
                "all",
                [
                    "has",
                    "is_bridge"
                ],
                [
                    "==",
                    "kind",
                    "highway"
                ],
                [
                    "!has",
                    "is_link"
                ]
            ],
            "paint": {
                "line-color": "#ffffff",
                "line-width": [
                    "interpolate",
                    [
                        "exponential",
                        1.6
                    ],
                    [
                        "zoom"
                    ],
                    3,
                    0,
                    6,
                    1.1,
                    12,
                    1.6,
                    15,
                    5,
                    18,
                    15
                ]
            }
        },
        {
            "id": "address_label",
            "type": "symbol",
            "source": "protomaps",
            "source-layer": "buildings",
            "minzoom": 18,
            "filter": [
                "==",
                "kind",
                "address"
            ],
            "layout": {
                "symbol-placement": "point",
                "text-font": [
                    "Noto Sans Italic"
                ],
                "text-field": [
                    "get",
                    "addr_housenumber"
                ],
                "text-size": 12
            },
            "paint": {
                "text-color": "#91888b",
                "text-halo-color": "#ffffff",
                "text-halo-width": 1
            }
        },
        {
            "id": "places_locality",
            "type": "symbol",
            "source": "protomaps",
            "source-layer": "places",
            "filter": [
                "==",
                "kind",
                "locality"
            ],
            "layout": {
                "icon-image": [
                    "step",
                    [
                        "zoom"
                    ],
                    [
                        "case",
                        [
                            "==",
                            [
                                "get",
                                "capital"
                            ],
                            "yes"
                        ],
                        "capital",
                        "townspot"
                    ],
                    8,
                    ""
                ],
                "icon-size": 0.7,
                "text-field": [
                    "case",
                    [
                        "all",
                        [
                            "any",
                            [
                                "has",
                                "name"
                            ],
                            [
                                "has",
                                "pgf:name"
                            ]
                        ],
                        [
                            "!",
                            [
                                "any",
                                [
                                    "has",
                                    "name2"
                                ],
                                [
                                    "has",
                                    "pgf:name2"
                                ]
                            ]
                        ],
                        [
                            "!",
                            [
                                "any",
                                [
                                    "has",
                                    "name3"
                                ],
                                [
                                    "has",
                                    "pgf:name3"
                                ]
                            ]
                        ]
                    ],
                    [
                        "case",
                        [
                            "has",
                            "script"
                        ],
                        [
                            "case",
                            [
                                "any",
                                [
                                    "is-supported-script",
                                    [
                                        "get",
                                        "name"
                                    ]
                                ],
                                [
                                    "has",
                                    "pgf:name"
                                ]
                            ],
                            [
                                "format",
                                [
                                    "coalesce",
                                    [
                                        "get",
                                        "name:en"
                                    ],
                                    [
                                        "get",
                                        "name:en"
                                    ]
                                ],
                                {},
                                "\n",
                                {},
                                [
                                    "case",
                                    [
                                        "all",
                                        [
                                            "!",
                                            [
                                                "has",
                                                "name:en"
                                            ]
                                        ],
                                        [
                                            "has",
                                            "name:en"
                                        ],
                                        [
                                            "!",
                                            [
                                                "has",
                                                "script"
                                            ]
                                        ]
                                    ],
                                    "",
                                    [
                                        "coalesce",
                                        [
                                            "get",
                                            "pgf:name"
                                        ],
                                        [
                                            "get",
                                            "name"
                                        ]
                                    ]
                                ],
                                {
                                    "text-font": [
                                        "case",
                                        [
                                            "==",
                                            [
                                                "get",
                                                "script"
                                            ],
                                            "Devanagari"
                                        ],
                                        [
                                            "literal",
                                            [
                                                "Noto Sans Devanagari Regular v1"
                                            ]
                                        ],
                                        [
                                            "literal",
                                            [
                                                "Noto Sans Regular"
                                            ]
                                        ]
                                    ]
                                }
                            ],
                            [
                                "get",
                                "name:en"
                            ]
                        ],
                        [
                            "format",
                            [
                                "coalesce",
                                [
                                    "get",
                                    "name:en"
                                ],
                                [
                                    "get",
                                    "pgf:name"
                                ],
                                [
                                    "get",
                                    "name"
                                ]
                            ],
                            {}
                        ]
                    ],
                    [
                        "get",
                        "name"
                    ]
                ],
                "text-font": [
                    "case",
                    [
                        "<=",
                        [
                            "get",
                            "min_zoom"
                        ],
                        5
                    ],
                    [
                        "literal",
                        [
                            "Noto Sans Medium"
                        ]
                    ],
                    [
                        "literal",
                        [
                            "Noto Sans Regular"
                        ]
                    ]
                ],
                "symbol-sort-key": [
                    "case",
                    [
                        "has",
                        "sort_key"
                    ],
                    [
                        "get",
                        "sort_key"
                    ],
                    [
                        "get",
                        "min_zoom"
                    ]
                ],
                "text-padding": [
                    "interpolate",
                    [
                        "linear"
                    ],
                    [
                        "zoom"
                    ],
                    5,
                    3,
                    8,
                    7,
                    12,
                    11
                ],
                "text-size": [
                    "interpolate",
                    [
                        "linear"
                    ],
                    [
                        "zoom"
                    ],
                    2,
                    [
                        "case",
                        [
                            "<",
                            [
                                "get",
                                "population_rank"
                            ],
                            13
                        ],
                        8,
                        [
                            ">=",
                            [
                                "get",
                                "population_rank"
                            ],
                            13
                        ],
                        13,
                        0
                    ],
                    4,
                    [
                        "case",
                        [
                            "<",
                            [
                                "get",
                                "population_rank"
                            ],
                            13
                        ],
                        10,
                        [
                            ">=",
                            [
                                "get",
                                "population_rank"
                            ],
                            13
                        ],
                        15,
                        0
                    ],
                    6,
                    [
                        "case",
                        [
                            "<",
                            [
                                "get",
                                "population_rank"
                            ],
                            12
                        ],
                        11,
                        [
                            ">=",
                            [
                                "get",
                                "population_rank"
                            ],
                            12
                        ],
                        17,
                        0
                    ],
                    8,
                    [
                        "case",
                        [
                            "<",
                            [
                                "get",
                                "population_rank"
                            ],
                            11
                        ],
                        11,
                        [
                            ">=",
                            [
                                "get",
                                "population_rank"
                            ],
                            11
                        ],
                        18,
                        0
                    ],
                    10,
                    [
                        "case",
                        [
                            "<",
                            [
                                "get",
                                "population_rank"
                            ],
                            9
                        ],
                        12,
                        [
                            ">=",
                            [
                                "get",
                                "population_rank"
                            ],
                            9
                        ],
                        20,
                        0
                    ],
                    15,
                    [
                        "case",
                        [
                            "<",
                            [
                                "get",
                                "population_rank"
                            ],
                            8
                        ],
                        12,
                        [
                            ">=",
                            [
                                "get",
                                "population_rank"
                            ],
                            8
                        ],
                        22,
                        0
                    ]
                ],
                "icon-padding": [
                    "interpolate",
                    [
                        "linear"
                    ],
                    [
                        "zoom"
                    ],
                    0,
                    0,
                    8,
                    4,
                    10,
                    8,
                    12,
                    6,
                    22,
                    2
                ],
                "text-justify": "auto",
                "text-variable-anchor": [
                    "step",
                    [
                        "zoom"
                    ],
                    [
                        "literal",
                        [
                            "bottom",
                            "left",
                            "right",
                            "top"
                        ]
                    ],
                    8,
                    [
                        "literal",
                        [
                            "center"
                        ]
                    ]
                ],
                "text-radial-offset": 0.3
            },
            "paint": {
                "text-color": "#5c5c5c",
                "text-halo-color": "#e0e0e0",
                "text-halo-width": 1
            }
        }
    ],
    "sprite": "https://protomaps.github.io/basemaps-assets/sprites/v4/light",
    "glyphs": "https://protomaps.github.io/basemaps-assets/fonts/{fontstack}/{range}.pbf"
};

// Initialize map
const map = new maplibregl.Map({
    container: 'map',
    style: style,
    center: [7.7461, 46.0382], // Matterhorn coordinates
    zoom: 12,
    pitch: 60,
    bearing: 0,
    antialias: true,
    hash: true
});

// Add controls
map.addControl(new maplibregl.NavigationControl({
    visualizePitch: true,
    showZoom: true,
    showCompass: true
}));

map.addControl(new maplibregl.GlobeControl());

// Enable terrain when map loads
map.on('load', () => {
    map.setTerrain({
        source: 'mapterhorn-terrain',
        exaggeration: 1.0
    });
});

// Terrain control functionality
const hillshadeCheckbox = document.getElementById('hillshade');
const terrain3dCheckbox = document.getElementById('terrain-3d');
const resetViewButton = document.getElementById('reset-view');
const flyToMatterhornButton = document.getElementById('fly-to-matterhorn');
const zermattViewButton = document.getElementById('zermatt-view');
const glacierViewButton = document.getElementById('glacier-view');

// Hillshade toggle
hillshadeCheckbox.addEventListener('change', (e) => {
    const visibility = e.target.checked ? 'visible' : 'none';
    map.setLayoutProperty('hillshade', 'visibility', visibility);
});

// 3D terrain toggle
terrain3dCheckbox.addEventListener('change', (e) => {
    if (e.target.checked) {
        map.setTerrain({ source: 'mapterhorn-terrain', exaggeration: 1.0 });
    } else {
        map.setTerrain(null);
    }
});

// Predefined viewpoints
const viewpoints = {
    default: {
        center: [7.7461, 46.0382],
        zoom: 12,
        pitch: 60,
        bearing: 0
    },
    matterhorn: {
        center: [7.7462, 45.9763],
        zoom: 15,
        pitch: 75,
        bearing: 25
    },
    zermatt: {
        center: [7.7461, 46.0278],
        zoom: 13,
        pitch: 50,
        bearing: 180
    },
    glacier: {
        center: [7.7580, 45.9850],
        zoom: 14,
        pitch: 60,
        bearing: 90
    }
};

// Navigation functions
function flyToViewpoint(viewpoint) {
    map.flyTo({
        center: viewpoint.center,
        zoom: viewpoint.zoom,
        pitch: viewpoint.pitch,
        bearing: viewpoint.bearing,
        duration: 3000
    });
}

// Button event listeners
resetViewButton.addEventListener('click', () => {
    flyToViewpoint(viewpoints.default);
});

flyToMatterhornButton.addEventListener('click', () => {
    flyToViewpoint(viewpoints.matterhorn);
});

zermattViewButton.addEventListener('click', () => {
    flyToViewpoint(viewpoints.zermatt);
});

glacierViewButton.addEventListener('click', () => {
    flyToViewpoint(viewpoints.glacier);
});

// Property display functionality
const propertiesPanel = document.getElementById('properties-panel');
const propertiesContent = document.getElementById('properties-content');
const closeButton = document.getElementById('close-panel');

// Close panel functionality
closeButton.addEventListener('click', () => {
  propertiesPanel.style.display = 'none';
});

// Map click handler for feature properties
map.on('click', (e) => {
  const features = map.queryRenderedFeatures(e.point);
  
  if (features.length > 0) {
    displayFeatureProperties(features);
    propertiesPanel.style.display = 'block';
  }
});

function displayFeatureProperties(features) {
  propertiesContent.innerHTML = '';
  
  features.forEach((feature, index) => {
    const featureDiv = document.createElement('div');
    featureDiv.className = 'feature-item';
    
    // Feature header
    const header = document.createElement('div');
    header.className = 'feature-header';
    const layerName = feature.layer ? feature.layer.id : 'Unknown Layer';
    const featureType = feature.geometry ? feature.geometry.type : 'Unknown';
    header.textContent = `${layerName} (${featureType})`;
    
    // Properties content
    const propsDiv = document.createElement('div');
    propsDiv.className = 'feature-properties';
    propsDiv.textContent = JSON.stringify(feature.properties, null, 2);
    
    // Toggle functionality
    header.addEventListener('click', () => {
      propsDiv.classList.toggle('collapsed');
    });
    
    featureDiv.appendChild(header);
    featureDiv.appendChild(propsDiv);
    propertiesContent.appendChild(featureDiv);
  });
}

// Log terrain configuration
console.log('Mapterhorn Terrain Visualization initialized');
console.log('Data source: https://tunnel.optgeo.org/martin/mapterhorn');
console.log('Features: 3D terrain, hillshade, interactive controls');

</script>
</body>
</html>